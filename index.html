<!DOCTYPE html>
<html>
<head>
    <title>Serious Business</title>
    <style>
        body {
            background-color: rgb(220, 220, 220);;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            font-family: cursive;
        }
        /*#square {
            width: 10px;
            height: 10px;
            background-color: blue;
            display: block;
        }*/

        /*.graysquare {
            width: 10px; 
            height: 10px; 
            background-color: gray; 
            display: inline-block;
        }
        .redsquare {
            width: 10px; 
            height: 10px; 
            background-color: red; 
            display: inline-block;
        }*/

        .square {
            width: 10px;
            height: 10px;
            background-color: gray;
            display: inline-block;
        }

        
       
        
        #ClickMe {
            background-color: rgb(246, 89, 89);
            width: 150px;
            height: 70px;
            font-size: 25px;
            transition: transform 0.8s ease-in-out, opacity 0.7s ease-out;
            cursor:pointer;
            border-radius: 20px;
            font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }
        #ClickMe:hover {
            transform: scale(1.05);
        }

        #ServerMessage {
            overflow: hidden;
            display: block;
            transform: translateX(-100vw);
            left:50%;
            position:relative;
            transition: transform 1.6s ease-in-out;
            white-space: pre-line;
            background-color: black;
            color: white;
            margin: 0px;
            padding: 5px;
            border-radius: 5px;
            font-family: cursive;
        }
        #ServerMessageContainer {
            position: relative; /* Add this line */
        }
        #HoverDisplay {
            bottom: 0; /* Position it at the bottom of the parent container */
            
        }

        
    </style>
</head>
<body>
    <h1 id = "Title">Serious Business</h1>
    <!--<div id = "square"></div>-->
    <br>    
    <button id = "ClickMe"> Click me!</button>
    <div id="ServerMessageContainer">
        <p id="ServerMessage">An Internal Error Occurred</p>
        <p id = "HoverDisplay"></p>
    </div>

    <script>
        const button = document.getElementById("ClickMe");
        const ServerMessage = document.getElementById("ServerMessage");
        const webSocket = new WebSocket('ws://localhost:8765');
        var MessageArray = [];
        var ChunkSize;
        webSocket.onmessage = (event) => {
            var message = event.data;
            
           // ServerMessage.innerHTML = message;
            console.log(message);
            var MessageLine = message.split("\n");
            ChunkSize = MessageLine[0];
            var RedSquareValues = [];
            var CutEndOff;
            for (let i = 1; i < MessageLine.length-1; i++) {
              
                MessageArray.push(MessageLine[i].split('|').slice(0, -1));
            }
            console.log(MessageArray);
            ServerMessage.innerHTML = "";
            for (let i = 0; i < MessageArray.length; i++) {
                for (let j = 0; j < MessageArray[i].length; j++) {
                    if (MessageArray[i][j] == "0") {
                        ServerMessage.innerHTML += '<div class = "square"></div>';
                    } else {
                        ServerMessage.innerHTML += '<div class = "square", style = "background-color: red;"></div>';
                        //RedSquareValues += MessageArray[i][j];
                    }
                    ServerMessage.innerHTML += ' ';
                }
                ServerMessage.innerHTML += '<br>';
                
            }
            const redsquares = document.querySelectorAll('.square');
        redsquares.forEach(square => {
            square.addEventListener('mouseenter', () => {
                handleRedSquareHover(square);
            });
            square.addEventListener('mouseleave', () => {
                handleRedSquareMouseExit(square);
            });
        });
            
        }
        const HoverDisplayElement = document.getElementById("HoverDisplay");
        function handleRedSquareHover(element) {
            //console.log(window.getComputedStyle(element).getPropertyValue("background-color"));
            if (window.getComputedStyle(element).getPropertyValue("background-color") === "rgb(255, 0, 0)") {
            // Get the index of the red square in the MessageArray
            const redsquares = document.querySelectorAll('.square');
            const index = Array.from(redsquares).indexOf(element);

            // Calculate the row and column index
            const numRows = MessageArray.length;
            const numCols = MessageArray[0].length;
            const rowIndex = Math.floor(index / numCols);
            const colIndex = index % numCols;
            const userName = MessageArray[rowIndex][colIndex];
            const regex = /\[(.*?)\]/g; 
            //console.log(userName);
            //console.log(userName.match(regex));
            const usernamesplit = userName.match(regex);
            //usernamesplit.split(",").slice(1)
            //HoverDisplayElement.innerHTML = `X: ${rowIndex*ChunkSize}, Z: ${colIndex*ChunkSize} <br>Username:<br> ${userName.slice(0, Math.floor(HoverDisplayElement.offsetWidth / 8))}`;
            console.log(usernamesplit);
            HoverDisplayElement.innerHTML = `X: ${String(usernamesplit).split(",")[0].slice(1)}, Z: ${String(usernamesplit).split(",")[1].slice(0, -1)} <br>Username:<br> ${userName.split("[")[0].slice(0, Math.floor(HoverDisplayElement.offsetWidth / 8))}`;
            //console.log(userName.split("[")[0].slice(0, Math.floor(HoverDisplayElement.offsetWidth / 8)));
            }
        }
        function handleRedSquareMouseExit(element) {
            HoverDisplayElement.innerHTML = "";
        }
        
        
        button.addEventListener('click', function() {
            button.style.transform = "translateX(500px)";
            button.style.opacity = "0"; 
            ServerMessage.style.transform = "translateX(-50%)";
            
        });

        const testsquare = document.getElementById("square");


        /*testsquare.addEventListener('mouseover', function () {
            console.log("");
            testsquare.style.backgroundColor = 'green';
        });*/

        

        // Add event listeners to redsquare elements
        
    
    </script>
</body>
</html>